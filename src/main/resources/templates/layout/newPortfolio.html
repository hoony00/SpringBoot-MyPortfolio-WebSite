<!-- 프젝 가로 1150 세로 770 -->
<!-- 이력서 가로 1350 세로 1800 -->
<script>
    /// todo : 가로세로 비율 맞춰서 자동으로 올라가게 기능 만들기 (가로 1150 세로 770) 가로 1350 세로 1800
    /// todo : 프로젝트 수정, 삭제 만들기
    /// todo : 시큐리티 공부

</script>
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <title>포토폴리오 관리 사이트</title>
    <!-- Favicon--> <!-- 경로 수정 -->
    <link rel="icon" type="image/x-icon" href="../bootstrap/assets/favicon.ico"/>
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css"/>
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet"
          type="text/css"/>
    <!-- Core theme CSS (includes Bootstrap)--> <!-- 경로 수정 -->
    <link href="/bootstrap/css/styles.css" rel="stylesheet"/>
</head>
<body id="page-top">

<!-- Top Navigation-->
<nav class="navbar navbar-expand-lg bg-hoon1 text-uppercase fixed-top" id="mainNav">
    <div class="container">
        <a class="navbar-brand" href="#page-top">포토폴리오 작성하기</a>
        <button class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded" type="button"
                data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive"
                aria-expanded="false" aria-label="Toggle navigation">
            Menu
            <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <!-- 상단 네비게이션 목록 -->
            <ul class="navbar-nav ms-auto">
                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="#portfolio">Portfolio</a>
                </li>
                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="#Introduce">Introduce</a>
                </li>
                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded"
                                                     href="#contact">Search</a></li>
                <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded"
                                                     href="/user/join">logout</a></li>

            </ul>
        </div>
    </div>
</nav>
<!-- 첫번쨰 섹션 ----------------------------------------->
<!-- Masthead-->
<header class="masthead bg-hoon2 text-white text-center">
 <!--   <style>
        /* CSS로 <header> 태그의 배경 이미지 설정 */
        header {
            background-image: url("../../bootstrap/assets/img/portfolio/header.png"); /* 배경 이미지 경로 설정 */
            background-size: cover; /* 이미지를 <header> 요소에 맞춥니다. */
            background-repeat: no-repeat; /* 이미지 반복 없음 */
            background-position: center center; /* 이미지 중앙 정렬 */
            height: 1000px; /* <header> 높이 조절 (원하는 높이로 설정) */
            color: white; /* 텍스트 색상 설정 (배경 이미지 위에 텍스트가 잘 보이게) */
            text-align: center; /* 텍스트 가운데 정렬 */
        }
    </style>-->
    <script>
        // 현재 프로필의 이메일을 전역 변수로 설정
        userEmail = '[[${userExplanation.email}]]';
        console.log("현재 프로필의 이메일 : " + userEmail);
    </script>

    <div class="container d-flex align-items-center flex-column">
        <div id="userExplanation" data-user-explanation="${userExplanation}"></div>
        <div class="col-md-6 col-lg-4 mb-5">
            <!-- 미리보기 이미지를 표시할 img 요소 -->
            <img id="previewImage" onclick="getImageSize()" class="masthead-avatar mb-5" src="../../bootstrap/assets/img/portfolio/people.png"
                 alt="프로필 사진"/>


            <form id="uploadForm" th:action="@{/user/uploadProfileImage}" method="post" enctype="multipart/form-data"
                  style="display: flex; align-items: center;">
                <!-- 파일 선택 input -->
                <input type="file" id="fileInput" name="file" accept="image/*" required style="flex: 1;" onchange="fileInput()">
                <!-- 이메일을 숨겨진 필드로 추가 -->
                <input type="hidden" id="email" name="email" th:value="${userExplanation.email}" required>
                <!-- 파일 저장 버튼 -->
                <button type="submit" id="uploadButton" style="flex: 0;">Update</button>
            </form>
            <div id="errorMessage" class="text-danger"></div>
        </div>

        <!-- JavaScript 코드 -->
        <script>
            function getImageSize(img) {
                console.log(img);
                var image = document.getElementById(img);

            }
            function fileInput (){

            }
            // 파일 입력란 변경 이벤트 감지
            document.getElementById('fileInput').addEventListener('change', function () {
                var fileInput = this;
                var previewImage = document.getElementById('previewImage');
                var width = previewImage.naturalWidth; // 이미지의 원본 가로 크기
                var height = previewImage.naturalHeight; // 이미지의 원본 가로 크기

                console.log('이미지의 가로 크기: ' + width + 'px');
                console.log('이미지의 세로 크기: ' + height + 'px');

                if (fileInput.files && fileInput.files[0]) {
                    var fileSize = fileInput.files[0].size; // 파일 크기 (바이트)
                    var maxSize = 1048576; // 1MB 제한 (1048576 바이트)

                    if (fileSize > maxSize) {
                        errorMessage.textContent = '파일 크기가 너무 큽니다. 1MB 이하의 파일을 업로드해 주세요.';
                        fileInput.value = ''; // 파일 선택 취소
                    } else {
                        errorMessage.textContent = ''; // 에러 메시지 초기화
                    }
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        previewImage.src = e.target.result;
                    };

                    reader.readAsDataURL(fileInput.files[0]);
                }
            });
        </script>

        <h1 class="masthead-heading text-uppercase mb-0" th:text="${userExplanation.name}"></h1>
        <!-- Masthead Heading-->
        <!-- Icon Divider-->
        <div class="divider-custom divider-light">
            <div class="divider-custom-line"></div>
            <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
            <div class="divider-custom-line"></div>
        </div>
        <!-- Masthead Subheading-->

        <div class="text-center mt-4">
            <p class="masthead-subheading font-weight-light mb-0" id="explanationText"
               th:text="${userExplanation.explanation}"></p>
        </div>

        <div class="col-lg-4 mx-auto text-center"> <!-- 중앙 정렬을 위해 mx-auto를 추가합니다 -->

            <!-- About Section Button (수정하기 버튼) -->
            <div class="text-center mt-4" id="editButton">
                <a class="btn btn-xl btn-outline-light" onclick="editExplain()">
                    <i class="fa-regular fa-pen-to-square"></i>
                    자기소개 수정
                </a>
            </div>
            <div id="explanationForm" style="display: none;">
                <form id="updateForm">
                    <div class="form-floating mb-3">
                        <input class="form-control" id="explanationInput" type="text" size="30"
                               th:value="${userExplanation.explanation}"/>
                        <label for="explanationInput">Explain</label>
                    </div>
                    <a class="btn btn-xl btn-outline-light" onclick="cancelButton()">
                        취소</a>
                    <a class="btn btn-xl btn-outline-light" onclick="updateButton()">
                        저장</a>
                </form>
            </div>
        </div>




        <script>
            function editExplain() {
                document.getElementById('explanationText').style.display = 'none';
                document.getElementById('editButton').style.display = 'none';
                document.getElementById('explanationForm').style.display = 'block';
            }

            document.getElementById('editButton').addEventListener('click', function () {
                // "수정하기" 버튼 클릭 시 편집 폼을 표시하고 버튼을 업데이트 버튼으로 변경
                document.getElementById('explanationText').style.display = 'none';
                document.getElementById('editButton').style.display = 'none';
                document.getElementById('explanationForm').style.display = 'block';
            });

            function cancelButton() {
                document.getElementById('explanationForm').style.display = 'none';
                document.getElementById('explanationText').style.display = 'block';
                document.getElementById('editButton').style.display = 'block';
            }

            function updateButton() {
                var newExplanation = document.getElementById('explanationInput').value;

                fetch('/user/updateExplanation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({explanation: newExplanation, email: userEmail}) // 이메일과 설명 데이터 전송
                })
                    .then(response => response.json())
                    .then(result => {
                        // 업데이트 결과 처리
                        if (result.result === 'success') {
                            console.log("업데이트 성공");
                            // 성공적으로 업데이트된 경우, 편집 폼을 숨기고 버튼을 "수정하기"로 변경
                            document.getElementById('explanationForm').style.display = 'none';
                            document.getElementById('explanationText').style.display = 'block';
                            document.getElementById('editButton').style.display = 'block';
                            // 설명 텍스트 업데이트
                            document.getElementById('explanationText').innerText = newExplanation;
                        }
                    })
                    .catch(error => {
                        console.error('오류 발생:', error);
                    });
            }



        </script>
    </div>
</header>

<!-- --------------------------------------------------Portfolio Section---------------------------------------------------->
<!-- --------------------------------------------------Portfolio Section---------------------------------------------------->
<!-- --------------------------------------------------Portfolio Section---------------------------------------------------->
<!-- --------------------------------------------------Portfolio Section---------------------------------------------------->
<!-- --------------------------------------------------Portfolio Section---------------------------------------------------->
<section class="page-section bg-hoon3 portfolio" id="portfolio">
    <div class="container">
        <!-- Portfolio Section Heading-->
        <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">Portfolio</h2>
        <!-- Icon Divider-->
        <div class="divider-custom">
            <div class="divider-custom-line"></div>
            <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
            <div class="divider-custom-line"></div>
        </div>

        <div class="col-lg-4 mx-auto text-center"> <!-- 중앙 정렬을 위해 mx-auto를 추가합니다 -->
            <!-- About Section Button (수정하기 버튼) -->
            <div class="text-center mt-4">
                <a class="btn btn-xl btn-outline-black" onclick="showModal()">
                    <i class="fa-solid fa-square-plus"></i>
                    Create New Project
                </a>
            </div>
        </div>


        <p></p>
        <!-- 프젝 추가 모달 ----- 프젝 추가 모달 ----------- 프젝 추가 모달 ----------- 프젝 추가 모달 ----------- 프젝 추가 모달 ----------- 프젝 추가 모달 ------------------->
        <!-- 프젝 추가 모달 ----- 프젝 추가 모달 ----------- 프젝 추가 모달 ----------- 프젝 추가 모달 ----------- 프젝 추가 모달 ----------- 프젝 추가 모달 ------------------->
        <div class="modal fade" id="createProjectModal" tabindex="-1" aria-labelledby="createProjectModalLabel"
             aria-hidden="true" >
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="createProjectModalLabel">Create New Project</h5>
                    </div>
                    <div class="modal-body">
                        <form id="createProjectForm">

                            <div class="form-group">
                                <label for="title">Title</label>
                                <input type="text" class="form-control" id="title" name="projectDTO.title">
                            </div>

                            <div class="form-group">
                                <label for="description">Description</label>
                                <textarea class="form-control" id="description" style="height: 350px"
                                          name="projectDTO.description"></textarea>
                            </div>

                            <div>
                                <label for="github">Github</label>
                                <input type="text" class="form-control" id="github" name="projectDTO.github" placeholder="https://github.com/hoony00/SpringBoot-MyPortfolio-WebSite">
                            </div>


                            <p></p>

                            <div class="form-group">
                                <label for="projectImage">Main Image</label>
                                <input type="file" class="form-control-file" id="projectImage" name="projectImage" onchange="checkFileSize(this)">
                            </div>
                            <span id="fileSizeError" style="color: red; display: none;">파일 크기가 너무 큽니다. 1MB 이하의 파일을 업로드해 주세요.</span>

                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="saveProjectButton">Save</button>
                    </div>

                </div>
            </div>
        </div>



<!-- 모달을 위한 자바스크립트 ----------------->
<!-- 모달을 위한 자바스크립트 ----------------->
<!-- 모달을 위한 자바스크립트 ----------------->
        <script>

            // 프로젝트 추가 모달을 표시
            function showModal() {
                var myModal = new bootstrap.Modal(document.getElementById('createProjectModal'));
                myModal.show();
            }



            // 파일 크기를 체크하는 함수
            function checkFileSize(input) {
                var maxSize = 1048576; // 1MB 제한 (바이트)
                var fileSize = input.files[0].size;

                if (fileSize > maxSize) {
                    document.getElementById('fileSizeError').style.display = 'block';
                    input.value = ''; // 파일 선택 해제
                } else {
                    document.getElementById('fileSizeError').style.display = 'none';
                }
            }

            // 새 프로젝트를 저장하기 위한 이벤트 처리
            document.getElementById("saveProjectButton").addEventListener("click", function () {
                // 폼 데이터를 수집
                const projectTitle = document.getElementById("title").value;
                const projectDescription = document.getElementById("description").value;
                const projectGithub = document.getElementById("github").value;
                const projectImage = document.getElementById("projectImage").files[0]; // 파일 선택 시
                if (!projectTitle || !projectDescription || !projectGithub || !projectImage) {
                    alert("모든 필수 항목을 입력해 주세요.");
                    return; // 필수 항목이 비어있으면 이후 로직 실행을 중단
                }

                //  저장된 프로젝트의 제목을 리턴 받아서 프로젝트 목록에 추가
                // FormData 생성
                const formData = new FormData();
                formData.append("email", userEmail);
                formData.append("title", projectTitle);
                formData.append("description", projectDescription);
                formData.append("github", projectGithub);
                formData.append("projectImage", projectImage);

                // 서버에 프로젝트 정보 전송
                fetch("/project/save", {
                    method: "POST",
                    body: formData,
                })
                    .then((response) => {
                        if (response.ok) {
                            console.log("프로젝트 저장 성공!");
                            location.reload();
                        } else {
                            throw new Error("프로젝트 저장에 실패했습니다.");
                        }
                    }).catch((error) => {
                        alert("오류 발생: " + error);
                    });


                // 모달을 닫습니다.
                document.getElementById("createProjectModal").style.display = "none";
            });

            // 모달이 닫힐 때 입력 필드를 초기화
            document.getElementById("createProjectModal").addEventListener("hidden.bs.modal", function () {
                document.getElementById("title").value = "";
                document.getElementById("description").value = "";
                document.getElementById("github").value = "";
                document.getElementById("projectImage").files[0] = null;
                document.getElementById('fileSizeError').style.display = 'none';

                var backdrop = document.querySelector('.modal-backdrop');
                if (backdrop) {
                    backdrop.remove();
                    document.body.style.overflow = '';

                }
            });


        </script>

        <!-- 프젝 추가 모달 끝---- 프젝 추가 모달  끝- ----------- 프젝 추가 모달  끝------------ 프젝 추가 모달 ----------- 프젝 추가 모달 ----------- 프젝 추가 모달 ------------------->
        <!-- 프젝 추가 모달 끝---- 프젝 추가 모달  끝- ----------- 프젝 추가 모달  끝------------ 프젝 추가 모달 ----------- 프젝 추가 모달 ----------- 프젝 추가 모달 ------------------->
        <!-- 프젝 추가 모달 끝---- 프젝 추가 모달  끝- ----------- 프젝 추가 모달  끝------------ 프젝 추가 모달 ----------- 프젝 추가 모달 ----------- 프젝 추가 모달 ------------------->


        <!-- Portfolio Grid Items------------------------------------------->
        <div class="row justify-content-center">
            <!-- Portfolio Item 1-->
            <div class="row justify-content-center" id="projectList"></div>

        </div> <!-- Portfolio Grid Items------------------------------------------->


        <script>
            async function fetchProjects() {
                try {
                    const response = await fetch('/projects/select?email=' + userEmail);
                    if (!response.ok) {
                        console.error('프로젝트 조회 중 오류 발생:', response.status, response.statusText);
                        return;
                    }

                    const data = await response.json();
                    console.log('프로젝트 조회 성공!');
                    console.log('이미지 개수:', data.length);


                    const infoResponse = await fetch('/projects/selectInfo?email=' + userEmail, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    });

                    if (infoResponse.ok) {
                        const anotherData = await infoResponse.json();

                        // 프로젝트 목록을 표시할 요소
                        const projectList = document.getElementById('projectList');
                        // 이미지를 동적으로 생성하고 목록에 추가
                        let modalCounter = 0; // 모달 번호를 추적하기 위한 변수

                        data.forEach(base64Image => {

                            // 프로젝트 아이템을 생성
                            const projectItem = document.createElement('div');
                            projectItem.className = 'col-md-6 col-lg-4 mb-5';

                            // 프로젝트 아이템에 제목 추가
                            const projectTitle = anotherData[modalCounter].title;
                            const projectDescription = anotherData[modalCounter].description;
                            const projectGithub = anotherData[modalCounter].github;
                            const proid = anotherData[modalCounter].proid;

                            // 모달을 생성
                            const modalId = 'portfolioModal' + modalCounter;
                            const editButtonId = 'editDes' + modalCounter;
                            const saveButtonId = 'mydessaveButton' + modalCounter;
                            const cancelButtonId = 'mydescancelButton' + modalCounter;
                            const descriptionTextareaId = 'mydescription' + modalCounter;
                            const deleteId = 'delete' + modalCounter;
                            const gitButton = 'mygitButton' + modalCounter;
                            const PortfolioInput = 'PortfolioInput' + modalCounter;
                            const projectModal = document.createElement('div');
                            projectModal.className = 'portfolio-item mx-auto';
                            projectModal.setAttribute('data-bs-toggle', 'modal');
                            projectModal.setAttribute('data-bs-target', '#' + modalId);

                            // 프로젝트 대표 이미지 생성
                            const projectImage = document.createElement('img');
                            projectImage.className = 'img-fluid';
                            projectImage.src = 'data:image/jpeg;base64,' + base64Image;


                            // 모달 창에 내용 추가
                            projectModal.appendChild(projectImage);

                            // 프로젝트 아이템을 프로젝트 목록에 추가
                            projectItem.appendChild(projectModal);
                            const modalContent = `
<div class="portfolio-modal modal fade" id="${modalId}" tabindex="-1" aria-labelledby="portfolioModal1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header border-0">
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center pb-5">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8">
                            <!-- Portfolio Modal - Title -->
                            <h2 class="portfolio-modal-title text-secondary text-uppercase mb-0">${projectTitle}</h2>
                            <!-- Icon Divider -->
                            <div class="divider-custom">
                                <div class="divider-custom-line"></div>
                                <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                                <div class="divider-custom-line"></div>
                            </div>
                            <button id ="${gitButton}" onclick="window.location.href = '${projectGithub}'" class="btn btn-primary" data-bs-dismiss="modal">
                                <i class="fa-brands fa-github"></i>
                                Visit GitHub
                            </button>
                            <!-- Portfolio Modal - Image -->
                            <img class="img-fluid rounded mb-5" src="${projectImage.src}" id="${PortfolioInput}" />
                            <!-- Portfolio Modal - Text -->
                            <p class="mb-4">
                                <textarea class="form-control" id="${descriptionTextareaId}" style="height: auto" name="projectDTO.description" readonly>
                                    ${projectDescription}
                                </textarea>
                                </p>
                          <button id="${editButtonId}" class="btn btn-warning des-edit" style="margin-right: 20px;"  onclick="edit('${modalCounter}')">
                                 <i class="fa-regular fa-pen-to-square"></i>
                                   수정하기
                           </button>
                           <button id="${saveButtonId}" class="btn btn-success" style="display: none; margin-right: 20px;">
                                 <i class="fa-regular fa-check-square"></i>
                                    저장하기
                            </button>
                            <button id="${deleteId}" class="btn btn-danger edit-des" style="display: none;" onclick="deletePort('${modalCounter}')">
                                 <i class="fa-solid fa-trash"></i>
                                    삭제
                            </button>

                               <p></p>
                            <button id="${cancelButtonId}" class="btn btn-secondary edit-des" style="display: none;">
                                 <i class="fa-regular fa-times-circle"></i>
                                    취소
                            </button>




                            <div id="${modalCounter}" style="display: none" >${proid}</div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
            `;
                            projectItem.style.border = '1px solid #ccc'; // 보더 스타일 및 색상을 설정하세요

                           // projectItem.style.marginRight = '1px'; // 원하는 간격(px)을 지정하세요

                            projectList.appendChild(projectItem);
                            // 모달을 동적으로 생성
                            // 모달을 HTML에 추가
                            document.body.insertAdjacentHTML('beforeend', modalContent);

                            modalCounter++; // 모달 번호 증가
                        });
                    }
                } catch (error) {
                    console.error('프로젝트 조회 오류:', error);
                }
            }
        </script>

<!-- 작업공간 ----------------------------------->
<!-- 작업공간 ----------------------------------->
<!-- 작업공간 ----------------------------------->
<!-- 작업공간 ----------------------------------->
        <script>
            function deletePort(modalCounter) {
                const modalId = 'delete' + modalCounter;

                const div = document.getElementById(modalCounter); // 해당 div 요소를 가져옵니다.
                const proid = div.textContent; // div의 내부 텍스트 값을 가져옵니다.
                console.log(proid+"삭제");

                const confirmation = window.confirm('정말 삭제하시겠습니까?'); // 확인 메시지 표시

                if (confirmation) {
                    // 사용자가 확인을 클릭한 경우
                    console.log(proid + " 삭제됨");
                    // 여기에 삭제 로직을 추가하세요.
                } else {
                    // 사용자가 취소를 클릭한 경우
                    console.log(proid + " 삭제 취소");
                    // 삭제 취소 또는 다른 작업을 수행하는 코드를 추가하세요.
                }



            }

            // 수정하기 버튼 클릭 시
            function edit(modalCounter) {
                // 수정하기 버튼의 모달 ID를 생성
                const modalId = 'portfolioModal' + modalCounter;

                // 프로젝트 id 값 받기
                const div = document.getElementById(modalCounter); // 해당 div 요소를 가져옵니다.
                const proid = div.textContent; // div의 내부 텍스트 값을 가져옵니다.


                // 모달 내의 요소를 조작
                const modal = document.getElementById(modalId);
                const editButton = document.getElementById('editDes' + modalCounter);
                const saveButton = document.getElementById('mydessaveButton' + modalCounter);
                const cancelButton = document.getElementById('mydescancelButton' + modalCounter);
                const descriptionTextarea = document.getElementById('mydescription' + modalCounter);
                const deleteBtn = document.getElementById('delete' + modalCounter);
                const gitButton = document.getElementById('mygitButton'+modalCounter);

                // 텍스트 에리어 수정 가능하도록 변경
                descriptionTextarea.readOnly = false;

                // 버튼 표시/숨김 조작
                editButton.style.display = 'none';
                saveButton.style.display = 'inline';
                cancelButton.style.display = 'inline';
                deleteBtn.style.display = 'inline';
                gitButton.style.display = 'none';

                //커서 이동
                descriptionTextarea.focus();
                const textLength = descriptionTextarea.value.length;
                descriptionTextarea.setSelectionRange(textLength, textLength);

                console.log("수정하기 버튼 클릭")

                // TODO: 수정 내용 저장 기능 구현
                saveButton.addEventListener('click', function () {
                    // proid 는 프로젝트 번호
                    // descriptionTextarea.value 는 수정된 내용
                    console.log("내용" +descriptionTextarea.value);
                    console.log("번호" + proid);

                    // API 엔드포인트 정의
                    const apiUrl = '/project/update'; // 실제 API 엔드포인트로 대체해야 합니다

                    // 요청 데이터 생성
                    const requestData = new FormData();
                    requestData.append('proid', proid);
                    requestData.append('des', descriptionTextarea.value);

                    // API에 POST 요청 보내기
                    fetch(apiUrl, {
                        method: 'POST',
                        body: requestData,
                    })
                        .then((response) => {
                            if (response.ok) {
                                console.log("프로젝트 수정 성공!");
                                location.reload();
                            } else {
                                throw new Error("프로젝트 수정 실패.");
                            }
                        }).catch((error) => {
                        alert("오류 발생: " + error);
                    });





                    // 저장 후 작업 (예: 수정 완료 후 버튼 변경, 텍스트 에리어 읽기 전용으로 변경 등)
                });

                // 취소 버튼 클릭 시 원래 상태로 복구
                cancelButton.addEventListener('click', function () {
                    descriptionTextarea.readOnly = true;

                    // 버튼 표시/숨김 조작
                    editButton.style.display = 'inline';
                    saveButton.style.display = 'none';
                    cancelButton.style.display = 'none';
                    gitButton.style.display = 'inline';
                    deleteBtn.style.display = 'none';

                });
            }
        </script>

    </div>
</section>


<!--- 포토폴리오 끝 --------------------------------------------------------------------------->
<!--- 포토폴리오 끝 --------------------------------------------------------------------------->
<!--- 포토폴리오 끝 --------------------------------------------------------------------------->

<!---------------------------------------------------- Introduce Section---------------------------------------------------->
<!---------------------------------------------------- Introduce Section---------------------------------------------------->
<!---------------------------------------------------- Introduce Section---------------------------------------------------->
<!---------------------------------------------------- Introduce Section---------------------------------------------------->
<!---------------------------------------------------- Introduce Section---------------------------------------------------->
<!---------------------------------------------------- Introduce Section---------------------------------------------------->
<section class="page-section bg-hoon4 text-white mb-0" id="Introduce">
    <div class="container">
        <!-- About Section Heading-->
        <h2 class="page-section-heading text-center text-uppercase text-white">Introduce</h2>
        <!-- Icon Divider-->
        <div class="divider-custom divider-light">
            <div class="divider-custom-line"></div>
            <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
            <div class="divider-custom-line"></div>
        </div>

        <!-- About Section Content-->
        <div class="row">
            <div class="col-lg-4 mx-auto text-center"> <!-- 중앙 정렬을 위해 mx-auto를 추가합니다 -->
                <!-- 자격증 -->
                <p class="lead">
                <h2>Certificate</h2>
                <ul id="cerList">
                    <!-- 스킬 목록은 여기에 동적으로 추가될 것입니다 -->
                </ul>
                </p>
            </div>

            <script>
                fetch(`/certification/select?email=${userEmail}`)
                    .then(response => response.json()) // JSON 응답 파싱
                    .then(data => {
                        const skillsList = document.getElementById('cerList');

                        if (data && data.length > 0) {
                            // 받아온 스킬 리스트를 ul 요소에 추가
                            skillsList.innerHTML = '';
                            data.forEach(skill => {
                                const li = document.createElement('li');
                                const h5 = document.createElement('h5');
                                h5.textContent = skill;
                                li.appendChild(h5);
                                skillsList.appendChild(li);
                            });
                        } else {
                            // 스킬 리스트가 비어있는 경우 메시지 표시
                            skillsList.innerHTML = '<li>No certificate found.</li>';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
            </script>

            <div class="col-lg-4 mx-auto text-center"> <!-- 중앙 정렬을 위해 mx-auto를 추가합니다 -->
                <!-- 기술스택 -->
                <p class="lead">
                <h2>Main Skills</h2>
                <ul id="skillsList">
                    <!-- 스킬 목록은 여기에 동적으로 추가될 것입니다 -->
                </ul>
                </p>
            </div>

            <script>
                    // AJAX를 사용하여 "/skill/select" 엔드포인트로 요청을 보냅니다.
                    fetch(`/skill/select?email=${userEmail}`)
                        .then(response => response.json()) // JSON 응답 파싱
                        .then(data => {
                            const skillsList = document.getElementById('skillsList');

                            if (data && data.length > 0) {
                                // 받아온 스킬 리스트를 ul 요소에 추가
                                skillsList.innerHTML = '';
                                data.forEach(skill => {
                                    const li = document.createElement('li');
                                    const h5 = document.createElement('h5');
                                    h5.textContent = skill;
                                    li.appendChild(h5);
                                    skillsList.appendChild(li);
                                });
                            } else {
                                // 스킬 리스트가 비어있는 경우 메시지 표시
                                skillsList.innerHTML = '<li>No skills found.</li>';
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
            </script>

<div class="col-lg-4 mx-auto text-center"> <!-- 중앙 정렬을 위해 mx-auto를 추가합니다 -->
    <!-- 핛력 -->
    <p class="lead">
    <h2>Main Skills</h2>
    <ul id="eduList">
    </ul>
    </p>
</div>
            </div>
        </div>

        <script>
            // AJAX를 사용하여 "/skill/select" 엔드포인트로 요청을 보냅니다.
            fetch(`/education/select?email=${userEmail}`)
                .then(response => response.json()) // JSON 응답 파싱
                .then(data => {
                    const skillsList = document.getElementById('eduList');

                    if (data && data.length > 0) {
                        // 받아온 스킬 리스트를 ul 요소에 추가
                        skillsList.innerHTML = '';
                        data.forEach(skill => {
                            const li = document.createElement('li');
                            const h5 = document.createElement('h5');
                            h5.textContent = skill;
                            li.appendChild(h5);
                            skillsList.appendChild(li);
                        });
                    } else {
                        // 스킬 리스트가 비어있는 경우 메시지 표시
                        skillsList.innerHTML = '<li>No skills found.</li>';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        </script>

        <!-- About Section Button (수정하기 버튼) -->
        <div class="text-center mt-4">
            <a class="btn btn-xl btn-outline-light" onclick="editIntro(userEmail)">
                <i class="fa-regular fa-pen-to-square"></i>
                Update
            </a>
        </div>
    </div>
</section>

<script>
    function editIntro(userEmail) {
        console.log("editIntro  눌림"+ userEmail);
    }
</script>

<!-- --------------------------      Search Section---------------------------------------------------->
<!-- --------------------------      Search Section---------------------------------------------------->
<!-- --------------------------      Search Section---------------------------------------------------->
<!-- --------------------------      Search Section---------------------------------------------------->
<section class="page-section" bg-hoon5 id="contact">
    <div class="container">
        <!-- Contact Section Heading-->
        <h2 class="page-section-heading text-center text-secondary mb-0">Search Email</h2>
        <!-- Icon Divider-->기
        <div class="divider-custom">
            <div class="divider-custom-line"></div>
            <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
            <div class="divider-custom-line"></div>
        </div>
        <!-- Contact Section Form-->
        <div class="row justify-content-center">
            <div class="col-lg-8 col-xl-7">
                <form id="contactForm" th:action="@{/user/uploadProfileImage}">
                    <!-- Name input-->
                    <div class="form-floating mb-3">
                        <input class="form-control" id="userEmail" name="userEmail" type="text"
                               placeholder="Enter User Email..." data-sb-validations="required"/>
                        <label for="userEmail">User Email</label>
                        <div class="invalid-feedback" data-sb-feedback="name:required">A Email is required.</div>
                    </div>

                    <div class="d-none" id="submitSuccessMessage">
                        <div class="text-center mb-3">
                            <div class="fw-bolder">Form submission successful!</div>
                            To activate this form, sign up at
                            <br/>
                            <a href="https://startbootstrap.com/solution/contact-forms">https://startbootstrap.com/solution/contact-forms</a>
                        </div>
                    </div>
                    <!-- Submit error message-->
                    <!-- an error submitting the form-->
                    <div class="d-none" id="submitErrorMessage">
                        <div class="text-center text-danger mb-3">Error sending message!</div>
                    </div>
                    <!-- Submit Button-->
                    <button class="btn btn-primary btn-xl " id="SearchButton" type="submit">search</button>
                </form>

                <script>
                    // 서버에 사용자가 존재하는지 확인하는 함수
                    document.getElementById('SearchButton').addEventListener('click', function (e) {
                        e.preventDefault(); // 기본 동작인 폼 제출을 방지

                        // 입력된 이메일 값을 가져오기
                        var email = document.getElementById('userEmail').value;

                        // 이메일을 사용하여 API 호출
                        fetch('/user/checkUser?email=' + email, {
                            method: 'GET'
                        })
                            .then(response => response.text())
                            .then(result => {
                                if (result === 'success') {
                                    // 사용자가 존재하는 경우
                                    window.location.href = "/user/getNameAndExplanation/" + email;
                                } else {
                                    // 사용자가 존재하지 않는 경우
                                    alert("사용자가 존재하지 않습니다.");
                                }
                            })
                            .catch(error => {
                                console.error('오류 발생:', error);
                            });
                    });
                </script>

            </div>
        </div>
    </div>
</section>


<!-- ------------------------------------        Footer            ---------------------------------->
<!-- ------------------------------------        Footer            ---------------------------------->
<!-- ------------------------------------        Footer            ---------------------------------->
<!-- ------------------------------------        Footer            ---------------------------------->
<footer class="footer text-center">
    <div class="container">
        <div class="row">
            <!-- Footer Location-->
            <div class="col-lg-4 mb-5 mb-lg-0">
                <h4 class="text-uppercase mb-4">인하공업전문대학</h4>
                <p class="lead mb-0">
                    2023 스프링프레임워크
                    <br/>
                    컴퓨터시스템과 이상훈
                </p>
            </div>
            <!-- Footer Social Icons-->
            <div class="col-lg-4 mb-5 mb-lg-0">
                <h4 class="text-uppercase mb-4">Around the Web</h4>
                <a class="btn btn-outline-light btn-social mx-1" href="#!"><i class="fab fa-fw fa-facebook-f"></i></a>
                <a class="btn btn-outline-light btn-social mx-1" href="#!"><i class="fab fa-fw fa-twitter"></i></a>
                <a class="btn btn-outline-light btn-social mx-1" href="#!"><i class="fab fa-fw fa-linkedin-in"></i></a>
                <a class="btn btn-outline-light btn-social mx-1" href="#!"><i class="fab fa-fw fa-dribbble"></i></a>
            </div>
            <!-- Footer About Text-->
            <div class="col-lg-4">
                <h4 class="text-uppercase mb-4">깃허브 바로가기</h4>
                <p class="lead mb-0">
                    <a href="https://github.com/hoony00/SpringBoot-MyPortfolio-WebSite">★Github★</a>
                </p>
            </div>
        </div>
    </div>
</footer>
<!-- Copyright Section-->
<div class="copyright py-4 text-center text-white">
    <div class="container"><small>Copyright &copy; Your Website 2023</small></div>
</div>

<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
<!-- * *                               SB Forms JS                               * *-->
<!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
<!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
<script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
<script>
    function loadProfileImage() {
        // 이메일을 사용하여 프로필 이미지 가져오기
        fetch('/user/profileImage/' + userEmail)
            .then(response => {
                if (response.ok) {
                    return response.blob();
                } else {
                    console.error('Error loading profile image:', response.status, response.statusText);
                    // 이미지가 없는 경우 기본 이미지 경로 설정
                    document.getElementById('previewImage').src = '../../bootstrap/assets/img/portfolio/people.png';

                }
            })
            // 가져온 프로필 이미지를 미리보기 이미지로 표시
            .then(blob => {
                if (blob) {
                    var url = URL.createObjectURL(blob);
                    document.getElementById('previewImage').src = url;
                }
            })
            // 에러가 발생한 경우
            .catch(error => {
                console.error('Error loading profile image:', error);
            });
    }


    document.getElementById('uploadForm').addEventListener('submit', function (e) {
        e.preventDefault(); // 기본 동작인 페이지 새로고침을 방지

        var form = e.target;
        var formData = new FormData(form);

        // 파일을 업로드하고 성공적으로 완료되면 이미지를 다시 로드
        fetch('/user/uploadProfileImage', {
            method: 'POST',
            body: formData
        })
            .then(function (response) {
                if (response.status === 200) {
                    alert('파일 업로드가 성공적으로 완료되었습니다.');
                    // 이미지를 다시 로드 (이미지를 보여주는 <img> 엘리먼트의 src 속성을 업데이트)
                    var email = document.getElementById('email').value;
                    console.log("파일 업로드 후 이메일 : " + email);
                } else {
                    alert('파일 업로드 실패');
                }
            })
            .catch(function (error) {
                alert('오류가 발생했습니다: ' + error);
            });
    });




    window.onload = function () {
        // fetchProjects 함수 호출
        fetchProjects();
        loadProfileImage();

    };
</script>

</body>
</html>
